### 동시성

#### 목차

- 동시성이 필요한 이유?
  - 미신과 오해
- 난관
- 동시성 방어 원칙
  - 단일 책임 원칙Single Responsibility Principle, SRP
  - 따름 정리corollary: 자료 범위를 제한하라
  - 따름 정리: 자료 사본을 사용하라
  - 따름 정리: 스레드는 가능한 독립적으로 구현하라
- 라이브러리를 이해하라
  - 스레드 환경에 안전한 컬렉션
- 실행 모델을 이해하라
  - 생산자-소비자Producer-Consumer
  - 읽기-쓰기Readers-Writers
  - 식사하는 철학자들Dining Philosophers
- 동기화하는 메서드 사이에 존재하는 의존성을 이해하라
- 동기화하는 부분을 작게 만들어라
- 올바른 종료 코드는 구현하기 어렵다
- 스레드 코드 테스트하기
  - 말이 안 되는 실패는 잠정적인 스레드 문제로 취급하라
  - 다중 스레드를 고려하지 않은 순차 코드부터 제대로 돌게 만들자
  - 다중 스레드를 쓰는 코드 부분을 다양한 환경에 쉽게 끼워 넣을 수 있게 스레드 코드를
- 구현하라
  - 다중 스레드를 쓰는 코드 부분을 상황에 맞게 조율할 수 있게 작성하라
  - 프로세서 수보다 많은 스레드를 돌려보라
  - 다른 플랫폼에서 돌려보라
  - 코드에 보조 코드instrument를 넣어 돌려라. 강제로 실패를 일으키게 해보라
  - 직접 구현하기
  - 자동화

#### 북마크

```
동시성은 결합(coupling)을 없애는 전략이다.
즉, 무엇(what)과 언제(when)을 분리하는 전략이다.

...

무엇과 언제를 분리하면 애플리케이션 구조와 효율이 극적으로 나아진다.

...

하지만 구조적 개선만을 위해 동시성을 채택하는 건 아니다.

-p226 ~ 227
```

```
다음은 동시성과 관련한 일반적인 미신과 오해다.

- 동시성은 항상 성능을 높여준다.
- 동시성을 구현해도 설계는 변하지 않는다.
- 웹 또는 EJB 컨테이너를 사용하면 동시성을 이해할 필요가 없다.

반대로 다음은 동시성과 관련된 타당한 생각 몇 가지다.

- 동시성은 다소 부하를 유발한다. 성능 측면에서 부하가 걸리며, 코드도 더 짜야 한다.
- 동시성은 복잡하다. 간단한 문제라도 동시성은 복잡하다.
- 일반적으로 동시성 버그는 재현하기 어렵다. 그래서 진짜 결함으로 간주되지 않고 일회성 문제로 여겨 무시하기 쉽다.
- 동시성을 구현하려면 흔히 근본적인 설계 전략을 재고해야 한다.

-p228
```

#### 내 생각

```
동시성 문제는 언제 봐도 어려운 내용 같습니다.
간단한 문제라도 동시성 문제에 대해 고려해야 할 상황이 너무 많기도 하고,
동시성을 해결하기 위한 방법도 너무 많기 때문에 적절한 상황에서 적절한 방법을 선택하는 것이 무척 어렵고,
그렇게 해서 해결한 방법이 100% 동시성을 해결했냐?라고 하면 그것도 아니라는 커뮤니티의 다른 개발자분들의 의견이 많습니다.

제가 동시성 문제를 경험해본 적은 없지만,
지금의 생각은 최대한 동시성 문제가 발생하지 않도록 코드를 짜는 것이 좋다고 생각합니다.

동시성 문제의 원인이 되는 공유 자원을 최대한 사용하지 않다던지,
어쩔수 없이 공유 자원을 사용한다면 임계 영역을 최소한으로 줄이던지 하는 방법으로 코드를 짜는 것이 좋다고 생각합니다.  
```