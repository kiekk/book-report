## 부록 A: 처음 해보는 성능 테스트를 위한 기본 정리

### 성능 테스트 종류
- 위키피디아의 정의에 따르면, 성능 테스트는 일반적으로 특정 작업 부하 상태에서 응답성과 안전성 측면에서 시스템이 어떻게 작동하는지를 확인하기 위해 수행하는 테스트 관행이다.
- 응답 시간, 처리량, 자원 사용량(CPU, 메모리 등)을 주로 측정한다.


#### 성능 테스트 종류

| 테스트 종류           | 설명                                                                                                      |
|------------------|---------------------------------------------------------------------------------------------------------|
| 부하(load) 테스트     | 특정한 예상 부하에서 시스템이 어떻게 동작하는지 확인한다.<br/>이 테스트를 통해 주요 기능의 응답 시간과 처리량 등의 성능 지표를 확인할 수 있고, 병목을 파악하는 데 도움이 된다. |
| 스트레스(stress) 테스트 | 시스템의 최대 성능을 확인하기 위한 테스트이다.<br/>예상을 뛰어넘는 부하가 발생했을 때, 시스템이 어디까지 성능을 낼 수 있는지를 확인한다.                        |
| 지속 부하(soak) 테스트  | 시스템이 지속적인 부하를 견딜 수 있는지를 검증한다.<br/>장시간 동안 일정 수준의 부하를 주어 성능 저하가 발생하는지 확인하며 메모리 누수도 탐지할 수 있다.              |
| 스파이크(spike) 테스트  | 급격하게 트래픽이 변화할 때 시스템의 반응성과 안정성을 검증하는 테스트이다.<br/>순간적으로 트래픽이 급증했을 때, 성능 저하나 실패가 발생하는지를 확인한다.               |


### 포화점과 버클존
- 성능이 저하되기 전의 최대 처리량을 포화점(saturation point)라고 한다.
- 포화점은 시스템이 감당할 수 있는 성능 한계 지점이다.
- 포화점을 지나 성능이 꺾이기 시작하는 구간을 버클존(buckle zone)이라고 한다.

```markdown
버클(buckle)

물리 현상에서 빌려온 개념으로 세로로 긴 구조물을 세로 방향으로 압축할 때 어느 순간
압축 하중을 견디지 못하고 구부러지는 것을 말한다.
버클존의 버클은 이 현상에서 빌려온 단어로 시스템이 한계를 초과했을 때 급격하게 성능이 저하되는 상황을 표현한다.
```

### 주요 측정 지표
- 성능 테스트에서 중요한 지표 중 하나는 응답 시간이다. 응답 시간은 다음과 같이 여러 값을 측정한다.
  - 평균
  - 최대
  - 최소
  - 중앙
  - 99%나 95% 백분위

- 응답 시간의 평균과 최대 값의 차이가 크다면 99%나 95% 백분위 값을 함께 확인해야 한다.
- 이 백분위 값이 최대 응답 시간보다 평균 값에 가깝다면 최대 값은 이상치일 수 있다.
- 중앙 값과 평균 값의 차이도 중요하다. 응답 시간이 중앙 값보다 평균 값이 더 큰 좌편향 분포를 보인다면 이는 응답 시간이 전반적으로 평균보다 느리다는 것을 의미한다.

#### 처리량
- 처리량은 TPS(Transaction Per Second)처럼 초 단위로 얼마나 많은 요청을 처리했는지를 나타낸다.


#### 에러율
- 에러율은 전체 요청 중에서 에러가 발생한 비율을 의미한다.
- 에러가 증가하기 시작하는 시점이 시스템의 한계일 가능성이 높다.

#### CPU 사용률
- 일반적으로는 웹 서버의 성능 문제는 DB나 외부 연동에서 발생하지만 높은 CPU 사용률로 인해 문제가 생기는 경우도 있다.


### 성능 테스트 설계 시 고려 사항
- 성능 테스트를 설계할 때는 다음 사항들을 고려해야 한다.
  - 시스템의 트래픽 패턴
  - 동시 요청 사용자 수 / 트래픽 규모
  - 기능별 요청 비율
  - 데이터 크기
  - 워밍업
  - 적절한 목표치 설정

- 트래픽이 짧은 시간에 증가하는 패턴을 보인다면 그에 맞춰 성능 테스트도 짧은 시간 간격으로 부하를 늘리는 방식으로 설계한다.


### 성능 테스트 도구
- nGinder
  - 네이버에서 개발한 부하 테스트 도구로 네이버에서 검증된 기술이다.
  - grinder를 기반으로 한다.
  - groovy나 jython을 이용해서 테스트용 스크립트를 작성한다.

- k6
  - grafana labs에서 개발한 부하 테스트 도구이다.
  - javascript를 이용해서 테스트용 스크립트를 작성한다.
  - cli로 실행하기 때문에 ci/cd 환경에 통합이 용이하다.

- Locust
- Gatling
- JMeter...


### 성능 테스트 실행 시 주의 사항
- 성능 테스트를 진행할 때 흔히 하는 실수 중 하나가 테스트 대상 시스템과 부하기를 한 장비에서 실행하는 것이다.
- 부하 생성은 그 자체로 많은 자원을 사용한다.
- 따라서 테스트 대상 시스템과 부하기를 한 장비에서 실행하면 테스트 대상 시스템이 자원을 온전히 활용하지 못해 실제 성능보다 낮은 결과가 나온다.

- 테스트 대상 시스템은 최대한 실제 운영 환경과 동일하게 구성해야 한다.
- 유효한 성능 지표를 구하려면 최대한 실 환경에 맞춰야 한다. 그래야 제대로 된 결과를 얻을 수 있다.


